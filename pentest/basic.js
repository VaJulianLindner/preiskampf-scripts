import http from "k6/http";
import { check } from "k6";

const routes = [
    "/",
    "/login",
    "/mein-profil"
];
const authRoutes = [
    "/einkaufszettel",
    "/einkaufstour",
    "/posts"
];

export const options = {
    thresholds: {},
    scenarios: {
        basic: {
            executor: "ramping-vus",
            gracefulStop: "30s",
            stages: [
                { target: 20, duration: "15s" },
                { target: 40, duration: "15s" },
                { target: 60, duration: "15s" },
                { target: 80, duration: "15s" },
                { target: 100, duration: "15s" },
                { target: 0, duration: "15s" },
            ],
            gracefulRampDown: "30s",
        },
    },
};

export default function () {
    for (let i = 0; i < routes.length; i++) {
        const res = http.get(`https://preiskampf.julian-lindner.com${routes[i]}`);
        check(res, { "status was 200": (r) => r.status == 200 });
    }

    if (__ENV.PREISKAMPF_AUTH_COOKIE) {
        for (let i = 0; i < authRoutes.length; i++) {
            const res = http.get(`https://preiskampf.julian-lindner.com${routes[i]}`, {
                cookies: {
                    preiskampf_auth_cookie: __ENV.PREISKAMPF_AUTH_COOKIE,
                },
            });
            check(res, { "status was 200": (r) => r.status == 200 });
        }
    } else {
        console.warn("skipping authenticated tests because no __ENV.PREISKAMPF_AUTH_COOKIE was provided");
    }
}